/*
purchase_transaction.min.js

Untuk Transaksi Pembelian
SIM MURIA PS
roniwahyu@gmail.com
*/
function gen_kdsp(a){$.get(baseurl+"get_sp_id/"+a,function(a,t){$("#add_supplier_form #Kode").prop("value",a)}),console.clear()}function gen_kdbarang(a){$.get(baseurl+"get_kdbarang/"+a,function(a,t){$("#form_barang #Kode").prop("value",a)}),console.clear()}function generate_kdbarang(){$("#form_barang #id_supplier").val();console.clear()}function save_supplier(a){var t=$("form#add_supplier_form").serializeArray();t.push({name:"ajax",value:1}),$(this).ready(function(){$.ajax({url:spurl+"submit/"+a,data:t,type:"POST",success:function(a){var t=JSON.parse(a);$("#id_supplier").append($("<option></option>").val(t.id_supplier).html(t.Kode+" ("+t.Nama+")")),$("#id_supplier").find("option[value="+t.id_supplier+"]").prop({selected:!0,disabled:!1})}})}),console.clear()}function save_satuan(a){var t=$("#addform_satuan").serializeArray();t.push({name:"ajax",value:1}),$(this).ready(function(){$.ajax({url:brgsatuurl+"submit/"+a,data:t,type:"POST",success:function(a){}})}),console.clear()}function save_harga(a){var t=$("#addform_harga").serializeArray();t.push({name:"ajax",value:1}),$(this).ready(function(){$.ajax({url:brgharga+"submit/"+a,data:t,type:"POST",success:function(a){}})}),console.clear()}function save_barang(a){var t=$("form#form_barang").serializeArray();t.push({name:"ajax",value:1}),$(this).ready(function(){$.ajax({url:brgurl+"submit/"+a,data:t,type:"POST",success:function(a){var t=JSON.parse(a);$("#Kode").find("option[value="+t.id+"]").prop({selected:!0,disabled:!1})}})}),console.clear()}function reset_barang(a){var t=$("#id_supplier").val();get_barang(t)}function get_barang(a){$("select#Kode option").remove(),$.getJSON(pourl+"get_drop_barang/"+enkrip+"/"+a,function(a){$.each(a,function(a,t){$("#Kode").append($("<option></option>").val(a).html(t))})}),console.clear()}function get_satuan(a){$("select#Satuan option").remove(),$.getJSON(pourl+"dropdown_satuan/"+a,function(a){$.each(a,function(a,t){$("#Satuan").append($("<option></option>").val(a).html(t))})}),console.clear()}function gettotal(){var a=$("#faktur_pt").val();$.get(baseurl+"get_pt_detail_total/"+enkrip+"/"+a,function(a,t){a>0?($("#totalbayar").val(a).trigger("change"),$("#totalbayarx").val(accounting.formatMoney(a,"Rp ",2)).trigger("change")):($("#totalbayar").val(0).trigger("change"),$("#totalbayarx").val(0).trigger("change"))}),console.clear()}function hitung(){var a=accounting.unformat($("#totalbayarx").val())>0?accounting.unformat($("#totalbayarx").val()):0,t=$("#ppn").val()>0?$("#ppn").val():0,e=$("#biayakirim").val()>0?$("#biayakirim").val():0;gtotalppn=parseFloat(a)+parseFloat(t/100*parseFloat(a)),gtotal=gtotalppn+parseFloat(e),$("#grandtotal").prop("value",gtotal),$("#grandtotalx").prop("value",accounting.formatMoney(gtotal,"Rp",2));var n=$("#uangmuka").val()>0?$("#uangmuka").val():0,r=gtotal-parseFloat(n);$("#sisa").prop("value",accounting.formatMoney(r,"Rp",2))}function get_po(a){$.get(pourl+"get/"+a,function(a){var t=JSON.parse(a),e=t.id_supplier;$("#id_supplier").find("option[value="+e+"]").prop({selected:!0,disabled:!1}),$("#id_supplier option:not(:selected)").attr("disabled",!0),$("#totalbayar").prop("value",t.totalbayar),$("#totalbayarx").prop("value",accounting.formatMoney(t.totalbayar,"Rp",2))}),console.clear()}function get_supplier(){$.get(baseurl+"get_dropdown_supplier/",function(a){$.each(a,function(a,t){$("#id_supplier").append($("<option></option>").val(a).html(t))})})}function new_faktur(){$.get(baseurl+"get_new_pt/",function(a,t){$("#faktur_pt").prop("value",a)})}$("document").ready(function(){var a=$("#faktur_pt").val();$("body").on("change","#id_tipe_beli",function(){"2"==$(this).val()?($(".panel_tambah").fadeOut(200),$("#bypo").fadeIn(200)):($(".panel_tambah").fadeIn(200),$("#bypo").fadeOut(200))}),$("body").on("change","#id_supplier",function(){var a=$("#id_tipe_beli");"1"==a&&reset_barang(enkrip)}),$("#id_supplier").change(function(){var a=$(this).val();get_barang(a)}),$("#Kode").change(function(){var a=$(this).val(),t=brgsatuurl+"satuan_barang/"+a+"/",e=brgharga+"harga_barang/"+enkrip+"/"+a+"/";$("#addsatuan").attr("data-load-satuan",t),$(".setup_harga").attr("data-load-harga",e),$(".setup_harga").attr("data-id",a),$("#addsatuan").attr("data-id",a),get_satuan(a),console.clear()});var t=$("#data").DataTable({ajax:{url:baseurl+"pt_detail/"+enkrip+"/"+a,dataType:"json"},sServerMethod:"POST",bServerSide:!0,paging:!1,deferRender:!0,bFilter:!1,ordering:!1}),e=$("#datax.tabelpo").DataTable({ajax:{url:baseurl+"getdatapo/"+enkrip,dataType:"json"},sServerMethod:"POST",bServerSide:!0});$("body").on("click",".loadpo",function(a){e.ajax.url(baseurl+"getdatapo/"+enkrip).load()}),$("body").on("click","[data-load-faktur]",function(a){a.preventDefault();var e=$(this),n=e.data("load-faktur"),r=e.data("faktur"),o=$(this).attr("id"),l=baseurl+"get_po_detail/"+r+"/"+enkrip+"/";n&&($("#faktur_po").prop("value",r),$("#faktur_po").prop("readonly",!0),$("#id_po").prop("value",o),t.ajax.url(l).load()),get_po(o),console.clear()}),$("body").on("click",".add_satuan",function(a){a.preventDefault();$(this).attr("data-remote-target");satuan=$(this).attr("data-load-satuan"),id=$(this).attr("data-id");var t=$(this);$(t.data("remote-target")).load(satuan,function(a){$("#modal-satuan").modal("show")})}),$("body").on("click",".setup_harga",function(a){a.preventDefault();$(this).attr("data-remote-target");harga=$(this).attr("data-load-harga"),id=$(this).attr("data-id");var t=$(this);$(t.data("remote-target")).load(harga,function(a){$("#modal-harga").modal("show")})}),$("body").on("click",".generate_pt",function(a){a.preventDefault(),new_faktur()}),$("body").on("click",".baru",function(a){a.preventDefault(),new_faktur(),t.clear(0).draw()}),$("body").on("click","#save_supplier",function(a){a.preventDefault(),save_supplier(enkrip)}),$("body").on("click","#save_barang",function(a){a.preventDefault(),save_barang(enkrip),reset_barang(enkrip)}),$("body").on("click","#save_satuan",function(a){a.preventDefault(),save_satuan(enkrip)}),$("body").on("click","#save_harga",function(a){a.preventDefault(),save_harga(enkrip)}),$("body").on("click",".edite",function(a){$("#save").fadeOut(200),$("#save_edit").fadeIn(200)}),$("body").on("click",".gen_kdsp",function(a){a.preventDefault(),gen_kdsp(enkrip)}),$("body").on("click",".refresh_barang",function(a){a.preventDefault(),reset_barang()}),$("#modal-form").on("shown.bs.modal",function(a){gen_kdsp(enkrip)}),$("#modal-satuan").on("close.bs.modal",function(a){$("#modal-satuan .modal-body").html("<br>")}),$("#modal-barang").on("shown.bs.modal",function(a){var t=$("#id_supplier").val();$.get(spurl+"get/"+t+"/"+enkrip,function(a,t){var e=JSON.parse(a);$("form#form_barang #id_supplier").find("option[value="+e.Kode+"]").prop({selected:!0,disabled:!1})})}),$("body").on("click",".btn-add",function(a){a.preventDefault();var e=($("#faktur_pt").val(),$("#Kode").val()),n=$("#Qty").val(),r=$("#Satuan").val(),o={id_barang:e,jumlah:n,id_satuan:r,pt:$("#faktur_pt").val(),ajax:1};$(this).ready(function(){$.ajax({url:baseurl+"submit_detail/"+enkrip,data:o,type:"POST",success:function(a){$("#Kode").prop("value",""),$("#Qty").prop("value",""),$("#Satuan").prop("value",""),$("#Satuan option").prop("selected",function(){return this.defaultSelected}),$("#Kode option").prop("selected",function(){return this.defaultSelected}),t.clear(0).draw(),gettotal()}})}),console.clear()}),$("body").on("click",".delete_temp",function(a){a.preventDefault();var e={id:$(this).attr("id"),ajax:1};confirm("Anda Yakin Ingin Menghapus Item Ini?")&&$(this).ready(function(){$.ajax({url:baseurl+"delete_detail",type:"POST",data:e,success:function(a){t.clear(0).draw(),gettotal()}})})}),$("body").on("change","#form_barang #id_golongan",function(a){a.preventDefault();var t=$("#form_barang #id_golongan").val();$.get(jnsbrgurl+"get_new_jenis/"+enkrip+"/"+t+"/",function(a,t){$("#form_barang #Kode").prop("value",a)})}),console.clear()});